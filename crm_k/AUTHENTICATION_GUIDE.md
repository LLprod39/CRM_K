# Руководство по аутентификации и админ панели

## Обзор

В CRM системе реализована система аутентификации с двумя ролями:
- **ADMIN** - полный доступ ко всем данным системы
- **USER** - доступ только к своим ученикам и данным

## Учетные данные по умолчанию

### Администратор
- **Email:** admin@crm.com
- **Пароль:** admin123
- **Роль:** ADMIN

### Тестовый пользователь
- **Email:** user@test.com
- **Пароль:** user123
- **Роль:** USER

## Функциональность

### Для обычных пользователей (USER)
- Вход в систему через `/login`
- Регистрация через `/register`
- Просмотр только своих учеников
- Создание новых учеников (привязываются к пользователю)
- Просмотр только своих занятий
- Финансовая статистика только по своим данным
- Выход из системы

### Для администраторов (ADMIN)
- Все функции обычных пользователей
- Доступ к админ панели `/admin`
- Просмотр всех пользователей системы
- Просмотр всех учеников всех пользователей
- Просмотр всех занятий
- Полная финансовая статистика по всей системе
- Управление системой

## Технические детали

### Аутентификация
- JWT токены для сессий
- Хеширование паролей с bcrypt
- Middleware для защиты маршрутов
- Контекст React для управления состоянием

### База данных
- Модель `User` с ролями
- Связь `Student` с `User` через `userId`
- Каскадное удаление при удалении пользователя

### API Защита
- Все API эндпоинты требуют аутентификации
- Фильтрация данных по ролям
- Проверка прав доступа

## Безопасность

1. **Пароли** хешируются с помощью bcrypt
2. **JWT токены** имеют срок действия 7 дней
3. **Middleware** проверяет аутентификацию на каждом запросе
4. **API эндпоинты** защищены от несанкционированного доступа
5. **Роли** определяют уровень доступа к данным

## Использование

1. Запустите приложение: `npm run dev`
2. Откройте http://localhost:3000
3. Войдите как администратор или зарегистрируйтесь как новый пользователь
4. Используйте систему согласно вашей роли

## Настройка

Для изменения JWT секрета создайте файл `.env.local`:
```
JWT_SECRET=your-super-secret-jwt-key
```

## Миграция данных

При первом запуске система автоматически:
1. Создаст таблицы пользователей
2. Назначит всех существующих учеников администратору
3. Создаст учетную запись администратора по умолчанию
