# Руководство по ИИ-функциям CRM системы

## Обзор

В CRM систему интегрирован Google Gemini AI для автоматической генерации предложений занятий на основе данных ученика, истории занятий и доступных игрушек.

## Основные функции

### 1. Генерация предложений занятий

**Расположение:** Профиль ученика → Раздел "Предложения занятий от ИИ"

**Как работает:**
- ИИ анализирует данные ученика (ФИО, возраст, диагноз, комментарии)
- Изучает историю последних 5 занятий
- Учитывает доступные игрушки в системе
- Генерирует детальный план занятия

**Что включает план:**
- Цели и задачи занятия
- Используемые игрушки и материалы
- Структуру занятия (разминка, основная часть, заключение)
- Особые рекомендации с учетом диагноза и возраста
- Ожидаемые результаты

### 2. Управление игрушками

**Расположение:** Админ-панель → Вкладка "Игрушки"

**Функции:**
- Добавление новых игрушек
- Редактирование существующих
- Удаление игрушек
- Управление доступностью
- Категоризация игрушек

**Категории игрушек:**
- Развивающие
- Сенсорные
- Музыкальные
- Конструкторы
- Образовательные
- Творческие
- Ролевые
- Моторные

## Техническая реализация

### API Endpoints

#### Генерация предложений занятий
```
POST /api/ai/lesson-suggestions
Body: { studentId: number }
Response: {
  suggestions: string,
  student: { fullName, age, diagnosis, comment },
  availableToys: number
}
```

#### Управление игрушками
```
GET /api/admin/toys - получить все игрушки
POST /api/admin/toys - создать игрушку
PUT /api/admin/toys/[id] - обновить игрушку
DELETE /api/admin/toys/[id] - удалить игрушку
```

### База данных

Добавлена таблица `toys`:
```sql
CREATE TABLE toys (
  id INTEGER PRIMARY KEY,
  name TEXT NOT NULL,
  description TEXT,
  category TEXT,
  isAvailable BOOLEAN DEFAULT true,
  createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,
  updatedAt DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### Компоненты

1. **LessonSuggestions** - компонент для отображения предложений ИИ
2. **ToysManagement** - компонент управления игрушками в админ-панели

## Использование

### Для педагогов

1. Откройте профиль ученика
2. Найдите раздел "Предложения занятий от ИИ"
3. Нажмите "Сгенерировать план"
4. Изучите предложенный план занятия
5. Используйте рекомендации при планировании урока

### Для администраторов

1. Войдите в админ-панель
2. Перейдите на вкладку "Игрушки"
3. Добавьте новые игрушки с описанием и категорией
4. Редактируйте существующие игрушки
5. Управляйте доступностью игрушек

## Тестовые данные

В системе уже добавлены тестовые игрушки:
- Кубики развивающие
- Пазлы "Животные"
- Сенсорные мячики
- Музыкальные инструменты
- Конструктор LEGO
- Книжки с картинками
- Пластилин
- Сортер "Формы"
- Кукольный театр
- Мозаика
- Лабиринт с шариками
- Магнитные буквы

## Настройка

### API ключ Google Gemini

API ключ встроен в код: `AIzaSyDGBAljOf_M5vZr8FhICnoH6w8ij4a87OQ`

Для продакшена рекомендуется:
1. Создать переменную окружения `GEMINI_API_KEY`
2. Обновить код для использования переменной окружения

### Модель ИИ

Используется модель `gemini-2.0-flash-exp` для быстрой генерации качественных предложений.

## Безопасность

- API ключ защищен на уровне сервера
- Доступ к управлению игрушками только для администраторов
- Валидация всех входных данных
- Обработка ошибок и исключений

## Мониторинг

Система логирует:
- Успешные запросы к ИИ
- Ошибки генерации предложений
- Действия с игрушками в админ-панели

## Планы развития

1. **Персонализация** - адаптация предложений под стиль работы педагога
2. **Аналитика** - отслеживание эффективности предложений ИИ
3. **Интеграция** - связь с календарем занятий
4. **Экспорт** - возможность экспорта планов занятий
5. **Шаблоны** - создание шаблонов на основе успешных занятий
