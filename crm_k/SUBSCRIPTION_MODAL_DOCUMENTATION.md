# Документация: Модальное окно абонементов

## Обзор

Новое модальное окно абонементов (`SubscriptionModal`) представляет собой переработанный интерфейс для создания абонементов с улучшенным пользовательским опытом, минималистичным дизайном и расширенной функциональностью.

## Основные особенности

### 1. Минималистичный дизайн
- Чистый и современный интерфейс без лишних элементов
- Логическая группировка полей по секциям
- Интуитивно понятная навигация
- Использование иконок для визуальной ясности

### 2. Улучшенный UX
- **Быстрый выбор периода**: Кнопки для выбора недели, месяца или произвольного периода
- **Визуальный выбор дней недели**: Компактные кнопки для дней недели с подсказками
- **Автоматический расчет**: Мгновенный подсчет количества занятий и общей суммы
- **Умные значения по умолчанию**: Предустановленные дни (Пн, Ср, Пт) и время (10:00)

### 3. Функциональность
- Создание индивидуальных и групповых абонементов
- Гибкая настройка расписания
- Автоматическое создание предоплаты
- Валидация в реальном времени

## Структура компонента

### Основные секции

#### 1. Выбор ученика/группы
```tsx
<ModalSection icon={<Users />} title="Ученик или группа">
  // Выбор типа занятия (индивидуальное/групповое)
  // Поиск и выбор учеников
  // Выбор учителя (только для админов)
</ModalSection>
```

#### 2. Период и расписание
```tsx
<ModalSection icon={<CalendarDays />} title="Период и расписание">
  // Быстрый выбор периода
  // Даты начала и окончания
  // Выбор дней недели
  // Время и продолжительность
</ModalSection>
```

#### 3. Стоимость и оплата
```tsx
<ModalSection icon={<DollarSign />} title="Стоимость и оплата">
  // Стоимость одного занятия
  // Автоматический расчет общей суммы
  // Настройка предоплаты
  // Заметки
</ModalSection>
```

## Вспомогательные компоненты

### QuickPeriodSelector
Компонент для быстрого выбора периода абонемента:
- **Неделя**: 7 дней от текущей даты
- **Месяц**: Текущий календарный месяц
- **Свой период**: Произвольные даты

### WeekDaySelector
Компонент для выбора дней недели:
- Компактные кнопки с сокращениями дней
- Подсказки с полными названиями
- Визуальная индикация выбранных дней

### SummaryCard
Карточка с итоговой информацией:
- Количество занятий
- Общая стоимость
- Поле для корректировки суммы предоплаты
- Процент предоплаты от общей суммы

## Использование

### В формах добавления занятий
```tsx
import SubscriptionModal from './SubscriptionModal';

// В компоненте
<SubscriptionModal
  isOpen={showSubscriptionModal}
  onClose={() => setShowSubscriptionModal(false)}
  onSuccess={() => {
    setShowSubscriptionModal(false);
    // Обновление данных
  }}
  selectedStudent={selectedStudent} // Опционально
/>
```

### В админ-панели
Кнопка "Абонемент" добавлена в раздел управления занятиями с фиолетовым цветом для визуального отличия.

## API интеграция

### Создание занятий
```
POST /api/lessons/bulk
```
Массовое создание занятий на основе расписания.

### Создание предоплаты
```
POST /api/payments/prepayment
```
Создание записи о предоплате с привязкой к периоду.

## Валидация

Модальное окно включает валидацию:
- Обязательные поля помечены и проверяются
- Ошибки отображаются под соответствующими полями
- Кнопка создания неактивна при отсутствии занятий
- Проверка корректности дат и сумм

## Адаптивность

Компонент полностью адаптивен:
- На мобильных устройствах поля выстраиваются вертикально
- Кнопки дней недели остаются удобными для нажатия
- Модальное окно занимает весь экран на маленьких устройствах

## Безопасность

- Проверка прав доступа (админ может выбирать учителя)
- Валидация данных на клиенте и сервере
- Защита от создания дублирующих записей

## Примеры использования

### Создание недельного абонемента
1. Нажмите кнопку "Абонемент"
2. Выберите ученика
3. Нажмите "Неделя" в быстром выборе периода
4. Выберите дни занятий (по умолчанию Пн, Ср, Пт)
5. Укажите время и стоимость
6. Нажмите "Создать абонемент"

### Создание группового абонемента на месяц
1. Выберите "Групповое" занятие
2. Добавьте нескольких учеников
3. Выберите период "Месяц"
4. Настройте расписание
5. Укажите стоимость для каждого ученика
6. Создайте абонемент

## Отличия от старой версии

| Старая версия (SubscriptionForm) | Новая версия (SubscriptionModal) |
|----------------------------------|-----------------------------------|
| Сложная форма с множеством полей | Минималистичный пошаговый интерфейс |
| Ручной ввод всех параметров | Быстрый выбор с умными значениями |
| Отдельные секции для каждого параметра | Логическая группировка по задачам |
| Большая форма с прокруткой | Компактное модальное окно |
| Сложный предпросмотр занятий | Простая карточка с итогами |

## Будущие улучшения

1. Добавление шаблонов абонементов
2. Возможность копирования существующих абонементов
3. Массовое создание абонементов для группы учеников
4. Интеграция с календарем для визуального выбора дат
5. Автоматическое продление абонементов
