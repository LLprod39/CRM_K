# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞–º –∏ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞–º

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞–º –∏ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞–º:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥–µ–ª–∏ —Ç–æ–ª—å–∫–æ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏–º –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞–ª–∏ (`userId`)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥–µ–ª–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã –¥–ª—è —Å–≤–æ–∏—Ö —É—á–µ–Ω–∏–∫–æ–≤
- –ê–¥–º–∏–Ω –º–æ–≥ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã —Å –ª—é–±—ã–º–∏ —É—á–µ–Ω–∏–∫–∞–º–∏ –¥–ª—è –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–ª—É—á–∞–ª –¥–æ—Å—Ç—É–ø –∫ —ç—Ç–∏–º –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞–º

## –†–µ—à–µ–Ω–∏–µ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤

**API `/api/flexible-subscriptions` (GET):**

**–î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
```typescript
if (authUser.role !== 'ADMIN') {
  whereClause.userId = authUser.id
}
```

**–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
```typescript
if (authUser.role !== 'ADMIN') {
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã –¥–ª—è —É—á–µ–Ω–∏–∫–æ–≤, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–≤–æ–¥–∏–ª –∑–∞–Ω—è—Ç–∏—è
  whereClause.student = {
    lessons: {
      some: {
        teacherId: authUser.id
      }
    }
  }
}
```

### 2. –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–µ–¥–æ–ø–ª–∞—Ç —É–∂–µ –±—ã–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π

**API `/api/payments` (GET):**
- –£–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É —Å `teacherId`
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã –¥–ª—è —É—á–µ–Ω–∏–∫–æ–≤, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –ø—Ä–æ–≤–æ–¥–∏–ª–∏ –∑–∞–Ω—è—Ç–∏—è

### 3. –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç —É–∂–µ –±—ã–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π

**API —Å–æ–∑–¥–∞–Ω–∏—è:**
- `/api/flexible-subscriptions` (POST) - –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ —É—á–µ–Ω–∏–∫–∞
- `/api/payments/prepayment` (POST) - –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ —É—á–µ–Ω–∏–∫–∞
- –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã —Å –ª—é–±—ã–º–∏ —É—á–µ–Ω–∏–∫–∞–º–∏ –¥–ª—è –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ **–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã** –¥–ª—è –≤—Å–µ—Ö —É—á–µ–Ω–∏–∫–æ–≤, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –ø—Ä–æ–≤–æ–¥–∏–ª–∏ –∑–∞–Ω—è—Ç–∏—è
2. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã** –¥–ª—è –≤—Å–µ—Ö —É—á–µ–Ω–∏–∫–æ–≤, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –ø—Ä–æ–≤–æ–¥–∏–ª–∏ –∑–∞–Ω—è—Ç–∏—è
3. **–ê–¥–º–∏–Ω –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã** —Å –ª—é–±—ã–º–∏ —É—á–µ–Ω–∏–∫–∞–º–∏ –¥–ª—è –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø** –∫ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞–º, —Å–æ–∑–¥–∞–Ω–Ω—ã–º –¥–ª—è –Ω–µ–≥–æ –∞–¥–º–∏–Ω–æ–º

### üîÑ **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ–ø–µ—Ä—å:**

1. **–ê–¥–º–∏–Ω** —Å–æ–∑–¥–∞–µ—Ç –∞–±–æ–Ω–µ–º–µ–Ω—Ç —Å —É—á–µ–Ω–∏–∫–æ–º –¥–ª—è **–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ê**
2. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê** –≤–∏–¥–∏—Ç –∞–±–æ–Ω–µ–º–µ–Ω—Ç –≤ —Å–≤–æ–µ–º —Å–ø–∏—Å–∫–µ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê** –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —ç—Ç–∏–º –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–º
4. –ï—Å–ª–∏ **–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë** —Ç–æ–∂–µ –ø—Ä–æ–≤–æ–¥–∏–ª –∑–∞–Ω—è—Ç–∏—è —Å —Ç–µ–º –∂–µ —É—á–µ–Ω–∏–∫–æ–º, –æ–Ω —Ç–æ–∂–µ –≤–∏–¥–∏—Ç –∞–±–æ–Ω–µ–º–µ–Ω—Ç
5. **–î–æ—Ö–æ–¥—ã** –æ—Å—Ç–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ - –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –∑–∞ —É—á–∏—Ç–µ–ª—è–º–∏, –ø—Ä–æ–≤–æ–¥–∏–≤—à–∏–º–∏ –∑–∞–Ω—è—Ç–∏—è

### üìã **–õ–æ–≥–∏–∫–∞ –¥–æ—Å—Ç—É–ø–∞:**

- **–ê–¥–º–∏–Ω**: –í–∏–¥–∏—Ç –≤—Å–µ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã –∏ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã
- **–û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: –í–∏–¥–∏—Ç –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã –∏ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã –¥–ª—è —É—á–µ–Ω–∏–∫–æ–≤, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –ø—Ä–æ–≤–æ–¥–∏–ª –∑–∞–Ω—è—Ç–∏—è

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π

- `src/app/api/flexible-subscriptions/route.ts` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã:

1. **–ê–¥–º–∏–Ω** —Å–æ–∑–¥–∞–µ—Ç –∞–±–æ–Ω–µ–º–µ–Ω—Ç —Å —É—á–µ–Ω–∏–∫–æ–º –¥–ª—è **–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ê**
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∞–±–æ–Ω–µ–º–µ–Ω—Ç –ø–æ—è–≤–∏–ª—Å—è –≤ —Å–ø–∏—Å–∫–µ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ê
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê** –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–º
4. –ï—Å–ª–∏ **–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë** —Ç–æ–∂–µ –ø—Ä–æ–≤–æ–¥–∏–ª –∑–∞–Ω—è—Ç–∏—è —Å —Ç–µ–º –∂–µ —É—á–µ–Ω–∏–∫–æ–º, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ–Ω —Ç–æ–∂–µ –≤–∏–¥–∏—Ç –∞–±–æ–Ω–µ–º–µ–Ω—Ç
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–æ—Ö–æ–¥—ã –æ—Å—Ç–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- ‚úÖ –ê–¥–º–∏–Ω –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã —Å –ª—é–±—ã–º–∏ —É—á–µ–Ω–∏–∫–∞–º–∏ –¥–ª—è –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –¥–æ—Å—Ç—É–ø –∫ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞–º, —Å–æ–∑–¥–∞–Ω–Ω—ã–º –¥–ª—è –Ω–∏—Ö –∞–¥–º–∏–Ω–æ–º
- ‚úÖ –î–æ—Ö–æ–¥—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –∑–∞ —É—á–∏—Ç–µ–ª—è–º–∏, –ø—Ä–æ–≤–æ–¥–∏–≤—à–∏–º–∏ –∑–∞–Ω—è—Ç–∏—è
