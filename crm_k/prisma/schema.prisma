// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Модель пользователя
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String
  role      UserRole @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Связь с учениками (один пользователь может иметь много учеников)
  students  Student[]
  
  @@map("users")
}

// Роли пользователей
enum UserRole {
  ADMIN  // Администратор - видит все данные
  USER   // Обычный пользователь - видит только своих учеников
}

// Модель ученика
model Student {
  id          Int      @id @default(autoincrement())
  fullName    String   // ФИО
  phone       String   // Телефон родителей
  age         Int      // Возраст
  parentName  String   // ФИО родителя (обязательно)
  diagnosis   String?  // Диагноз (опционально)
  comment     String?  // Комментарий (опционально)
  photoUrl    String?  // URL фото ученика (опционально)
  userId      Int      // ID пользователя-владельца
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Связь с пользователем
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Связь с занятиями
  lessons     Lesson[]
  
  // Связь с платежами
  payments    Payment[]
  
  // Связь с предложениями ИИ
  aiSuggestions AISuggestion[]
  
  @@map("students")
}

// Модель занятия
model Lesson {
  id          Int      @id @default(autoincrement())
  date        DateTime // Дата и время начала занятия
  endTime     DateTime // Дата и время окончания занятия
  studentId   Int      // ID ученика
  cost        Float    // Стоимость занятия
  isCompleted Boolean  @default(false) // Проведено ли занятие
  isPaid      Boolean  @default(false) // Оплачено ли занятие
  isCancelled Boolean  @default(false) // Отменено ли занятие
  notes       String?  // Заметки к занятию
  lessonType  String   @default("individual") // Тип занятия: individual, group
  location    String   @default("office") // Место проведения: office, online, home
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Связь с учеником
  student     Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  
  // Связь с платежами
  payments    PaymentLesson[]
  
  @@map("lessons")
}


// Модель платежа
model Payment {
  id          Int      @id @default(autoincrement())
  studentId   Int      // ID ученика
  amount      Float    // Сумма платежа
  date        DateTime // Дата платежа
  description String?  // Описание платежа
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Связь с учеником
  student     Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  
  // Связь с уроками через промежуточную таблицу
  lessons     PaymentLesson[]
  
  @@map("payments")
}

// Промежуточная таблица для связи платежей и уроков
model PaymentLesson {
  id        Int     @id @default(autoincrement())
  paymentId Int     // ID платежа
  lessonId  Int     // ID урока
  
  // Связи
  payment   Payment @relation(fields: [paymentId], references: [id], onDelete: Cascade)
  lesson    Lesson  @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  
  @@unique([paymentId, lessonId])
  @@map("payment_lessons")
}

// Модель игрушек
model Toy {
  id          Int      @id @default(autoincrement())
  name        String   // Название игрушки
  description String?  // Описание игрушки
  category    String?  // Категория игрушки (развивающие, сенсорные, моторные и т.д.)
  isAvailable Boolean  @default(true) // Доступна ли игрушка
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("toys")
}

// Модель предложений ИИ
model AISuggestion {
  id          Int      @id @default(autoincrement())
  studentId   Int      // ID ученика
  title       String   // Название занятия
  duration    String   // Продолжительность
  goals       String   // JSON массив целей
  materials   String   // JSON массив материалов
  structure   String   // JSON структура занятия
  recommendations String // JSON массив рекомендаций
  expectedResults String // JSON массив ожидаемых результатов
  notes       String?  // Дополнительные заметки
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Связь с учеником
  student     Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  
  @@map("ai_suggestions")
}